<!DOCTYPE html>
<html>

  <head>
    <title>My App</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  </head>

  <body>
    <h1>HW</h1>
    <button id="authenticate">Click here to try a fetch</button>
    <div id="users">Protected endpoint data</div>
    <div id="payload"></div>
    <div id="open">Open endpoint data</div>
    <div id="payload-open"></div>
  </body>

  <script type="module">

    import { useOAuth2 } from './oauth2.js';

//    const resource_server = "https://home.juxt.site"
//    const authorization_server = "https://auth.home.juxt.site"

    const resource_server = "https://data.site.test"
    const authorization_server = "https://auth.site.test"
    const app_server = "https://surveyor.apps.com"

    const { controlled_fetch } = useOAuth2([{
      origin: resource_server, // ???
      client_id: "surveyor",
      authorization_endpoint: `${authorization_server}/oauth/authorize`,
      token_endpoint: `${authorization_server}/oauth/token`,
      redirect_uri: `${app_server}/index.html`,
      requested_scopes: ""
    }]);

    document
  .getElementById("authenticate")
  .addEventListener("click", async () => {
    console.dir(await controlled_fetch(`${resource_server}/_site/users`, {}))
    // "https://swapi.dev/api/people/1/"
  });

  </script>

</html>
