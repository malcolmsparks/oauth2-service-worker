<!DOCTYPE html>
<html>

<head>
  <title>My App</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html,
    body {
      height: 100%;
    }
  </style>

</head>

<body>
  <div class="flex justify-center items-center h-full">

    <div>

      <button id="login"
        class="bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded">
        Login
      </button>
      <button id="api"
        class="bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded">
        API
      </button>
      <div id="data"></div>
    </div>
  </div>
</body>

<script type="module">

  import { exchangeCodeForAccessToken, authorize, useOAuth2 } from './oauth2.js';

  const resource_server = "https://home.juxt.site"
  const authorization_server = "https://auth.home.juxt.site"

  // const resource_server = "https://data.site.test"
  // const authorization_server = "https://auth.site.test"
  const app_server = "https://surveyor.apps.com"

  // invoked solely to initialize the service worker
  useOAuth2();

  const authorizeFn = async () => authorize({
    origin: resource_server,
    client_id: "surveyor",
    authorization_endpoint: `${authorization_server}/oauth/authorize`,
    token_endpoint: `${authorization_server}/oauth/token`,
    redirect_uri: `${app_server}/index.html`,
    requested_scopes: ""
  })

  document
    .getElementById("login")
    .addEventListener("click", authorizeFn);

  document
    .getElementById("api")
    .addEventListener("click", async () => {
      const res = await fetch(`${resource_server}/_site/users`, {})
      const data = await res.text()
      document.getElementById("data").innerHTML =
        `<div class="bg-gray-200 p-4 mt-4 rounded-md">
      ${data}
      </div>`
    });


</script>

</html>